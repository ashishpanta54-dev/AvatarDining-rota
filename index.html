<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Avatar Dining Weekly Rota</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    header {
      background: #222;
      color: #fff;
      padding: 10px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      font-size: 18px;
      margin: 0;
    }
    header span {
      font-size: 13px;
      opacity: 0.8;
    }
    main {
      padding: 12px;
      max-width: 1000px;
      margin: 0 auto;
    }
    .top-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
    }
    .top-bar input, .top-bar button {
      font-size: 14px;
      padding: 6px 8px;
    }
    .top-bar button {
      border-radius: 4px;
      border: none;
      background: #1d7dfa;
      color: #fff;
      cursor: pointer;
    }
    .top-bar button.secondary {
      background: #ddd;
      color: #333;
    }
    .top-bar button.danger {
      background: #c0392b;
      color: #fff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      font-size: 13px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 4px 6px;
      text-align: center;
    }
    th {
      background: #fafafa;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    td.employee {
      text-align: left;
      font-weight: 600;
      white-space: nowrap;
    }

    /* Colour rules for MH, LW, OFF */
    .cell-mh {
      background: #ffe680; /* yellow */
    }
    .cell-lw {
      background: #b7f7b0; /* green */
    }
    .cell-off {
      background: #ffb3b3; /* red */
    }

    .editable-cell input {
      width: 100%;
      border: none;
      text-align: center;
      padding: 2px;
      font-size: 13px;
      box-sizing: border-box;
      background: transparent;
    }
    .editable-cell input:focus {
      outline: 1px solid #1d7dfa;
    }
    #login-panel {
      display: flex;
      gap: 4px;
      align-items: center;
      font-size: 13px;
    }
    #login-panel input {
      padding: 4px 6px;
      font-size: 13px;
    }
    #status {
      font-size: 12px;
      margin-top: 6px;
      color: #555;
    }
    @media (max-width: 700px) {
      th, td {
        font-size: 11px;
        padding: 3px;
      }
      header h1 {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Avatar Dining – Weekly Rota</h1>
      <span id="week-label">Week starting: 25/01/2026</span>
    </div>
    <div id="login-panel">
      <span id="role-label">Viewing as: Staff</span>
      <input type="password" id="manager-pass" placeholder="Manager PIN" />
      <button id="login-btn">Login</button>
      <button id="logout-btn" style="display:none;">Logout</button>
    </div>
  </header>

  <main>
    <div class="top-bar">
      <label for="week-input">Week starting:</label>
      <input type="date" id="week-input" />
      <button id="new-week-btn" class="secondary">Create / switch week</button>
      <button id="share-btn" class="secondary">Copy rota as text</button>
      <button id="reset-btn" class="danger">Reset to default week</button>
    </div>
    <div id="status"></div>
    <div style="overflow-x:auto; max-height: 75vh; border:1px solid #ddd;">
      <table id="rota-table">
        <!-- Filled by JS -->
      </table>
    </div>
  </main>

  <script>
    // ==== CONFIG ====
    const MANAGER_PIN = "1234"; // CHANGE THIS and tell only your manager

    const employeesTemplate = [
      "Laxuman",
      "Rajendra",
      "Dichhya",
      "Ashish.P",
      "Suraj",
      "Nishan",
      "Depika",
      "Anthony",
      "Ashish.N",
      "Dinesh",
      "Sudesh",
      "Chhabi",
      "Rima",
      "Puspha"
    ];

    const defaultWeek = "2026-01-25"; // ISO for 25/01/2026
    const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

    // All empty by default – you fill MH / LW / OFF
    const defaultShifts = {
      "Laxuman": ["","","","","","",""],
      "Rajendra": ["","","","","","",""],
      "Dichhya": ["","","","","","",""],
      "Ashish.P": ["","","","","","",""],
      "Suraj": ["","","","","","",""],
      "Nishan": ["","","","","","",""],
      "Depika": ["","","","","","",""],
      "Anthony": ["","","","","","",""],
      "Ashish.N": ["","","","","","",""],
      "Dinesh": ["","","","","","",""],
      "Sudesh": ["","","","","","",""],
      "Chhabi": ["","","","","","",""],
      "Rima": ["","","","","","",""],
      "Puspha": ["","","","","","",""]
    };

    // ==== STORAGE ====
    function storageKeyForWeek(isoDate) {
      return "avatar_rota_week_" + isoDate;
    }

    function saveWeek(isoDate, data) {
      localStorage.setItem(storageKeyForWeek(isoDate), JSON.stringify(data));
    }

    function loadWeek(isoDate) {
      const raw = localStorage.getItem(storageKeyForWeek(isoDate));
      if (!raw) return null;
      try {
        return JSON.parse(raw);
      } catch(e) {
        return null;
      }
    }

    function createDefaultWeekData() {
      return employeesTemplate.map((name, index) => {
        return {
          no: index + 1,
          employee: name,
          shifts: defaultShifts[name] ? [...defaultShifts[name]] : ["","","","","","",""]
        };
      });
    }

    // ==== STATE ====
    let currentWeek = defaultWeek;
    let currentData = [];
    let isManager = false;

    const weekLabel = document.getElementById("week-label");
    const weekInput = document.getElementById("week-input");
    const tableEl = document.getElementById("rota-table");
    const statusEl = document.getElementById("status");
    const roleLabel = document.getElementById("role-label");
    const managerPassInput = document.getElementById("manager-pass");
    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const newWeekBtn = document.getElementById("new-week-btn");
    const shareBtn = document.getElementById("share-btn");
    const resetBtn = document.getElementById("reset-btn");

    // ==== UI HELPERS ====
    function isoToDisplay(iso) {
      const d = new Date(iso);
      if (isNaN(d.getTime())) return iso;
      const dd = String(d.getDate()).padStart(2, "0");
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const yyyy = d.getFullYear();
      return dd + "/" + mm + "/" + yyyy;
    }

    function setStatus(msg) {
      statusEl.textContent = msg || "";
    }

    function cellClassFromValue(value) {
      const v = (value || "").toUpperCase();
      if (v === "MH") return "cell-mh";   // yellow
      if (v === "LW") return "cell-lw";   // green
      if (v === "OFF") return "cell-off"; // red
      return "";
    }

    function renderTable() {
      tableEl.innerHTML = "";
      const thead = document.createElement("thead");
      const headRow = document.createElement("tr");
      const headers = ["No", "Employee", ...days];
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        headRow.appendChild(th);
      });
      thead.appendChild(headRow);
      tableEl.appendChild(thead);

      const tbody = document.createElement("tbody");

      currentData.forEach((row, rowIndex) => {
        const tr = document.createElement("tr");

        // No
        const tdNo = document.createElement("td");
        tdNo.textContent = row.no;
        tr.appendChild(tdNo);

        // Employee
        const tdEmp = document.createElement("td");
        tdEmp.textContent = row.employee;
        tdEmp.className = "employee";
        tr.appendChild(tdEmp);

        // Days
        days.forEach((day, dayIndex) => {
          const td = document.createElement("td");
          const value = row.shifts[dayIndex] || "";
          td.className = cellClassFromValue(value);

          if (isManager) {
            td.classList.add("editable-cell");
            const input = document.createElement("input");
            input.value = value;
            input.setAttribute("data-row", rowIndex);
            input.setAttribute("data-day", dayIndex);
            input.addEventListener("change", onCellEdit);
            td.appendChild(input);
          } else {
            const span = document.createElement("span");
            span.textContent = value;
            td.appendChild(span);
          }

          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      tableEl.appendChild(tbody);
    }

    function onCellEdit(e) {
      const rowIndex = parseInt(e.target.getAttribute("data-row"), 10);
      const dayIndex = parseInt(e.target.getAttribute("data-day"), 10);
      const val = (e.target.value || "").toUpperCase().trim();
      // Allow only MH, LW, OFF, or blank
      const allowed = ["MH", "LW", "OFF", ""];
      if (!allowed.includes(val)) {
        e.target.value = currentData[rowIndex].shifts[dayIndex] || "";
        alert("Use only: MH, LW, OFF or leave blank.");
        return;
      }
      currentData[rowIndex].shifts[dayIndex] = val;
      saveWeek(currentWeek, currentData);
      setStatus("Changes saved for " + isoToDisplay(currentWeek));
      renderTable(); // refresh colours
    }

    function loadOrCreateWeek(isoDate) {
      currentWeek = isoDate;
      const stored = loadWeek(isoDate);
      if (stored && Array.isArray(stored) && stored.length) {
        currentData = stored;
      } else {
        currentData = createDefaultWeekData();
        saveWeek(isoDate, currentData);
      }
      weekLabel.textContent = "Week starting: " + isoToDisplay(isoDate);
      weekInput.value = isoDate;
      renderTable();
      setStatus("Loaded week " + isoToDisplay(isoDate));
    }

    function copyRotaAsText() {
      let text = "Avatar Dining – Rota (" + isoToDisplay(currentWeek) + ")\\n\\n";
      text += "No | Employee | " + days.join(" | ") + "\\n";
      text += "-".repeat(80) + "\\n";
      currentData.forEach(row => {
        text += row.no + " | " + row.employee + " | " + row.shifts.join(" | ") + "\\n";
      });
      navigator.clipboard.writeText(text)
        .then(() => setStatus("Rota copied to clipboard – paste into WhatsApp or email."))
        .catch(() => setStatus("Could not copy rota – your browser may block clipboard."));
    }

    // ==== EVENT HANDLERS ====
    loginBtn.addEventListener("click", () => {
      const entered = managerPassInput.value;
      if (entered === MANAGER_PIN) {
        isManager = true;
        roleLabel.textContent = "Viewing as: Manager";
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        managerPassInput.value = "";
        renderTable();
        setStatus("Manager mode enabled.");
      } else {
        alert("Wrong PIN.");
      }
    });

    logoutBtn.addEventListener("click", () => {
      isManager = false;
      roleLabel.textContent = "Viewing as: Staff";
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      renderTable();
      setStatus("Logged out of manager mode.");
    });

    newWeekBtn.addEventListener("click", () => {
      const val = weekInput.value;
      if (!val) {
        alert("Pick a week start date first.");
        return;
      }
      loadOrCreateWeek(val);
    });

    shareBtn.addEventListener("click", copyRotaAsText);

    resetBtn.addEventListener("click", () => {
      if (!confirm("Reset default week to blank for all staff? This cannot be undone.")) return;
      currentWeek = defaultWeek;
      currentData = createDefaultWeekData();
      saveWeek(currentWeek, currentData);
      loadOrCreateWeek(defaultWeek);
      setStatus("Default week reset to blank.");
    });

    // ==== INIT ====
    document.addEventListener("DOMContentLoaded", () => {
      loadOrCreateWeek(defaultWeek);
    });
  </script>
</body>
</html>
